"use strict";(()=>{(function(){"use strict";var u=document.currentScript;if(!u)return;var b=u.getAttribute("data-token");if(!b||!b.trim()){console.warn("[LocalBot AI] Missing data-token on script tag.");return}var f="";try{f=new URL(u.src).origin}catch{console.warn("[LocalBot AI] Could not determine script origin.");return}var h="lba-session-"+b.trim(),d=24,g=420,y=380,E=480;function k(){try{var e=localStorage.getItem(h);if(e)return e;var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var n=Math.random()*16|0,o=a==="x"?n:n&3|8;return o.toString(16)});return localStorage.setItem(h,t),t}catch{return"session-"+Date.now()+"-"+Math.random().toString(36).slice(2)}}function L(){if(!document.getElementById("lba-widget-styles")){var e=document.createElement("style");e.id="lba-widget-styles",e.textContent=".lba-bubble{position:fixed;width:56px;height:56px;border-radius:50%;border:none;cursor:pointer;box-shadow:0 4px 12px rgba(0,0,0,.15);display:flex;align-items:center;justify-content:center;color:#fff;font-size:24px;transition:transform .2s,box-shadow .2s;z-index:2147483646}.lba-bubble:hover{transform:scale(1.05);box-shadow:0 6px 16px rgba(0,0,0,.2)}.lba-bubble:active{transform:scale(.98)}.lba-bubble.lba-pos-bottom-right{bottom:"+d+"px;right:"+d+"px}.lba-bubble.lba-pos-bottom-left{bottom:"+d+"px;left:"+d+"px}.lba-bubble.lba-pos-top-right{top:"+d+"px;right:"+d+"px}.lba-bubble.lba-pos-top-left{top:"+d+"px;left:"+d+"px}.lba-panel{position:fixed;background:#fff;border-radius:12px 12px 0 0;box-shadow:0 -4px 24px rgba(0,0,0,.12);display:flex;flex-direction:column;z-index:2147483647;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;overflow:hidden;transition:transform .3s ease}.lba-panel.lba-closed{transform:translateY(100%)}.lba-panel.lba-pos-bottom-right,.lba-panel.lba-pos-bottom-left{bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:"+y+"px;height:"+g+"px;max-height:85vh}.lba-panel.lba-closed.lba-pos-bottom-right,.lba-panel.lba-closed.lba-pos-bottom-left{transform:translate(-50%,100%)}.lba-panel.lba-pos-top-right,.lba-panel.lba-pos-top-left{top:0;left:50%;transform:translateX(-50%);width:100%;max-width:"+y+"px;height:"+g+"px;max-height:85vh}.lba-panel.lba-closed.lba-pos-top-right,.lba-panel.lba-closed.lba-pos-top-left{transform:translate(-50%,-100%)}@media (max-width:"+E+"px){.lba-panel{max-width:100%;border-radius:12px 12px 0 0}}.lba-panel-header{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;background:var(--lba-primary,#0ea5e9);color:#fff;flex-shrink:0}.lba-panel-title{font-weight:600;font-size:16px}.lba-panel-close{background:transparent;border:none;color:inherit;cursor:pointer;padding:4px;line-height:1;opacity:.9}.lba-panel-close:hover{opacity:1}.lba-messages{flex:1;overflow-y:auto;padding:16px;display:flex;flex-direction:column;gap:12px;background:#f8fafc}.lba-msg{max-width:85%;padding:10px 14px;border-radius:12px;font-size:14px;line-height:1.5;word-wrap:break-word}.lba-msg-user{align-self:flex-end;background:var(--lba-primary,#0ea5e9);color:#fff;border-bottom-right-radius:4px}.lba-msg-bot{align-self:flex-start;background:#fff;color:#1e293b;border:1px solid #e2e8f0;border-bottom-left-radius:4px}.lba-msg-welcome{align-self:flex-start}.lba-typing{display:flex;gap:4px;padding:10px 14px;align-self:flex-start}.lba-typing span{width:8px;height:8px;border-radius:50%;background:#94a3b8;animation:lba-bounce 1.4s ease-in-out infinite both}.lba-typing span:nth-child(1){animation-delay:-.32s}.lba-typing span:nth-child(2){animation-delay:-.16s}@keyframes lba-bounce{0%,80%,100%{transform:scale(0)}40%{transform:scale(1)}}.lba-input-row{display:flex;gap:8px;padding:12px 16px;background:#fff;border-top:1px solid #e2e8f0;flex-shrink:0}.lba-input{flex:1;padding:10px 14px;border:1px solid #e2e8f0;border-radius:8px;font-size:14px;font-family:inherit}.lba-input:focus{outline:none;border-color:var(--lba-primary,#0ea5e9)}.lba-send{padding:10px 16px;background:var(--lba-primary,#0ea5e9);color:#fff;border:none;border-radius:8px;font-weight:500;cursor:pointer;flex-shrink:0}.lba-send:hover{opacity:.95}.lba-send:disabled{opacity:.6;cursor:not-allowed}.lba-footer{padding:8px 16px;text-align:center;flex-shrink:0;background:#f1f5f9;border-top:1px solid #e2e8f0}.lba-footer a{font-size:12px;color:#64748b;text-decoration:none}.lba-footer a:hover{text-decoration:underline}",document.head.appendChild(e)}}function v(e){var t=(e||"bottom-right").toLowerCase();return t==="bottom-left"?"lba-pos-bottom-left":t==="top-right"?"lba-pos-top-right":t==="top-left"?"lba-pos-top-left":"lba-pos-bottom-right"}function B(e){var t=document.createElement("button");return t.type="button",t.className="lba-bubble "+v(e.widgetPosition),t.setAttribute("aria-label","Open chat"),t.style.backgroundColor=e.primaryColor||"#0ea5e9",t.innerHTML="&#128172;",t}function N(e){var t=document.createElement("div");t.className="lba-panel lba-closed "+v(e.widgetPosition),t.setAttribute("aria-hidden","true");var a=document.createElement("div");a.className="lba-panel-header",a.style.backgroundColor=e.primaryColor||"#0ea5e9";var n=document.createElement("span");n.className="lba-panel-title",n.textContent=e.botName||"Assistant";var o=document.createElement("button");o.type="button",o.className="lba-panel-close",o.setAttribute("aria-label","Close"),o.innerHTML="&#10005;",a.appendChild(n),a.appendChild(o),t.appendChild(a);var i=document.createElement("div");i.className="lba-messages";var c=e.welcomeMessage||"Hi! How can I help?",p=document.createElement("div");p.className="lba-msg lba-msg-bot lba-msg-welcome",p.textContent=c,i.appendChild(p),t.appendChild(i);var r=document.createElement("div");r.className="lba-input-row";var l=document.createElement("input");l.type="text",l.className="lba-input",l.placeholder="Type a message...",l.setAttribute("autocomplete","off");var s=document.createElement("button");s.type="button",s.className="lba-send",s.textContent="Send",s.style.backgroundColor=e.primaryColor||"#0ea5e9",r.appendChild(l),r.appendChild(s),t.appendChild(r);var x=document.createElement("div");return x.className="lba-footer",x.innerHTML='<a href="https://localbot.ai" target="_blank" rel="noopener">Powered by LocalBot AI</a>',t.appendChild(x),{panel:t,messagesEl:i,input:l,sendBtn:s,closeBtn:o}}function m(e,t,a){var n=document.createElement("div");n.className="lba-msg "+(a?"lba-msg-user":"lba-msg-bot"),n.textContent=t,e.appendChild(n),e.scrollTop=e.scrollHeight}function A(e){var t=document.createElement("div");return t.className="lba-typing",t.innerHTML="<span></span><span></span><span></span>",t.setAttribute("data-lba-typing","1"),e.appendChild(t),e.scrollTop=e.scrollHeight,t}function w(e){var t=e.querySelector("[data-lba-typing]");t&&t.remove()}function C(){L(),fetch(f+"/api/widget-config/"+encodeURIComponent(b.trim())).then(function(e){if(!e.ok)throw new Error("Config failed "+e.status);return e.json()}).then(function(e){document.documentElement.style.setProperty("--lba-primary",e.primaryColor||"#0ea5e9");var t=B(e),a=N(e),n=a.panel,o=a.messagesEl,i=a.input,c=a.sendBtn;t.addEventListener("click",function(){n.classList.remove("lba-closed"),n.setAttribute("aria-hidden","false"),i.focus()}),a.closeBtn.addEventListener("click",function(){n.classList.add("lba-closed"),n.setAttribute("aria-hidden","true")});function p(){var r=(i.value||"").trim();r&&(i.value="",m(o,r,!0),A(o),c.disabled=!0,fetch(f+"/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:b.trim(),message:r,session_id:k()})}).then(function(l){return l.json().then(function(s){if(!l.ok)throw new Error(s.error||"Request failed");return s})}).then(function(l){w(o),m(o,l.answer||"",!1)}).catch(function(l){w(o),m(o,"Sorry, something went wrong. Please try again.",!1)}).finally(function(){c.disabled=!1,i.focus()}))}c.addEventListener("click",p),i.addEventListener("keydown",function(r){r.key==="Enter"&&!r.shiftKey&&(r.preventDefault(),p())}),document.body.appendChild(t),document.body.appendChild(n)}).catch(function(e){console.warn("[LocalBot AI] Could not load widget config:",e)})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",C):C()})();})();
