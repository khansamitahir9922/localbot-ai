"use strict";(()=>{(function(){"use strict";var R=document.currentScript;if(!R)return;var C=R.getAttribute("data-token");if(!C||!C.trim()){console.warn("[LocalBot AI] Missing data-token on script tag.");return}var j="";try{j=new URL(R.src).origin}catch{console.warn("[LocalBot AI] Could not determine script origin.");return}var G="lba_session_"+C.trim(),Q="lba_config_",re="lba_welcome_dismissed_",le=36e5,d=24,se=56,pe=8,P=d+se+pe,I=12,F=380,D=520,ce=480,X=45,de=600;function be(t){var e=Q+(t||C).trim();try{var n=localStorage.getItem(e);if(!n)return null;var o=JSON.parse(n);if(!o||typeof o.lastFetched!="number"||Date.now()-o.lastFetched>le)return null;var s={};return o.botName!==void 0&&(s.botName=o.botName),o.primaryColor!==void 0&&(s.primaryColor=o.primaryColor),o.welcomeMessage!==void 0&&(s.welcomeMessage=o.welcomeMessage),o.fallbackMessage!==void 0&&(s.fallbackMessage=o.fallbackMessage),o.widgetPosition!==void 0&&(s.widgetPosition=o.widgetPosition),o.avatarStyle!==void 0&&(s.avatarStyle=o.avatarStyle),s}catch{return null}}function me(t,e){if(!(!e||typeof e!="object")){var n=Q+(t||C).trim();try{var o={botName:e.botName,primaryColor:e.primaryColor,welcomeMessage:e.welcomeMessage,fallbackMessage:e.fallbackMessage,widgetPosition:e.widgetPosition,avatarStyle:e.avatarStyle,lastFetched:Date.now()};localStorage.setItem(n,JSON.stringify(o))}catch{}}}function ue(){try{var t=localStorage.getItem(G);if(t)return t;var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var o=Math.random()*16|0,s=n==="x"?o:o&3|8;return s.toString(16)});return localStorage.setItem(G,e),e}catch{return"session-"+Date.now()+"-"+Math.random().toString(36).slice(2)}}function he(){if(!document.getElementById("lba-widget-styles")){var t=document.createElement("style");t.id="lba-widget-styles";var e=".lba-bubble{position:fixed!important;width:56px!important;height:56px!important;border-radius:50%!important;border:none!important;cursor:pointer!important;box-shadow:0 4px 14px rgba(0,0,0,.18)!important;display:flex!important;align-items:center;justify-content:center;color:#fff!important;font-size:24px!important;transition:transform .2s ease,box-shadow .2s ease,opacity .2s ease;z-index:2147483646;}.lba-bubble:hover{transform:scale(1.06)!important;box-shadow:0 6px 20px rgba(0,0,0,.22)!important}.lba-bubble:active{transform:scale(.98)!important}.lba-bubble:focus{outline:2px solid rgba(255,255,255,.5);outline-offset:2px}.lba-bubble.lba-pos-bottom-right{bottom:"+d+"px;right:"+d+"px;z-index:2147483647!important}.lba-bubble.lba-pos-bottom-left{bottom:"+d+"px;left:"+d+"px;z-index:2147483647!important}.lba-bubble.lba-pos-top-right{top:"+d+"px;right:"+d+"px;z-index:2147483647!important}.lba-bubble.lba-pos-top-left{top:"+d+"px;left:"+d+"px;z-index:2147483647!important}.lba-welcome-wrap{position:fixed!important;z-index:2147483645;display:flex;align-items:flex-end;pointer-events:none;opacity:0;transition:opacity .3s ease;}.lba-welcome-wrap.lba-welcome-visible{pointer-events:auto;opacity:1}.lba-welcome-wrap.lba-welcome-hidden{opacity:0!important;pointer-events:none!important;transition:opacity .2s ease}.lba-welcome-bubble{background:#fff!important;border-radius:12px!important;box-shadow:0 4px 20px rgba(0,0,0,.12),0 0 1px rgba(0,0,0,.08)!important;padding:14px 18px 14px 16px!important;max-width:260px!important;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif!important;position:relative!important;pointer-events:auto}.lba-welcome-bubble::after{content:''!important;position:absolute!important;width:0;height:0;border:8px solid transparent!important}.lba-welcome-wrap.lba-pos-bottom-right .lba-welcome-bubble::after{border-left-color:#fff!important;border-right:none!important;right:-14px!important;bottom:20px!important}.lba-welcome-wrap.lba-pos-bottom-left .lba-welcome-bubble::after{border-right-color:#fff!important;border-left:none!important;left:-14px!important;bottom:20px!important}.lba-welcome-wrap.lba-pos-top-right .lba-welcome-bubble::after{border-left-color:#fff!important;border-right:none!important;right:-14px!important;top:20px!important;bottom:auto!important}.lba-welcome-wrap.lba-pos-top-left .lba-welcome-bubble::after{border-right-color:#fff!important;border-left:none!important;left:-14px!important;top:20px!important;bottom:auto!important}.lba-welcome-line1{font-size:15px!important;font-weight:600!important;color:#334155!important;line-height:1.35!important;min-height:1.35em}.lba-welcome-line2{font-size:14px!important;color:#64748b!important;line-height:1.4!important;margin-top:4px!important;min-height:1.4em}.lba-welcome-cursor{display:inline-block;width:2px;height:1em;background:#64748b;animation:lba-blink 1s step-end infinite;vertical-align:text-bottom}@keyframes lba-blink{50%{opacity:0}}.lba-welcome-close{position:absolute!important;top:8px!important;right:8px!important;width:24px!important;height:24px!important;border:none!important;background:transparent!important;cursor:pointer!important;border-radius:4px!important;color:#94a3b8!important;font-size:16px!important;line-height:1!important;padding:0!important;display:flex!important;align-items:center!important;justify-content:center!important}.lba-welcome-close:hover{color:#64748b!important;background:#f1f5f9!important}.lba-welcome-wrap.lba-pos-bottom-right{bottom:"+d+"px;right:"+(d+56+I)+"px}.lba-welcome-wrap.lba-pos-bottom-left{bottom:"+d+"px;left:"+(d+56+I)+"px}.lba-welcome-wrap.lba-pos-top-right{top:"+d+"px;right:"+(d+56+I)+"px}.lba-welcome-wrap.lba-pos-top-left{top:"+d+"px;left:"+(d+56+I)+"px}.lba-panel{position:fixed!important;background:#fff!important;border-radius:12px 12px 0 0!important;box-shadow:0 -4px 28px rgba(0,0,0,.15),0 0 1px rgba(0,0,0,.08)!important;display:flex;flex-direction:column;z-index:2147483646;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif!important;overflow:hidden;transition:transform .3s cubic-bezier(0.32,0.72,0,1),opacity .25s ease;}.lba-panel.lba-closed{transform:translateY(100%);opacity:0;pointer-events:none}.lba-panel.lba-pos-bottom-right{bottom:"+P+"px;right:"+d+"px;left:auto;width:100%;max-width:"+F+"px;height:"+D+"px;max-height:calc(100vh - "+P+"px)}.lba-panel.lba-closed.lba-pos-bottom-right{transform:translateY(100%)}.lba-panel.lba-pos-bottom-left{bottom:"+P+"px;left:"+d+"px;right:auto;width:100%;max-width:"+F+"px;height:"+D+"px;max-height:calc(100vh - "+P+"px)}.lba-panel.lba-closed.lba-pos-bottom-left{transform:translateY(100%)}.lba-panel.lba-pos-top-right{top:0;right:0;left:auto;width:100%;max-width:"+F+"px;height:"+D+"px;max-height:85vh}.lba-panel.lba-closed.lba-pos-top-right{transform:translateY(-100%)}.lba-panel.lba-pos-top-left{top:0;left:0;right:auto;width:100%;max-width:"+F+"px;height:"+D+"px;max-height:85vh}.lba-panel.lba-closed.lba-pos-top-left{transform:translateY(-100%)}@media (max-width:"+ce+"px){.lba-panel.lba-pos-bottom-right,.lba-panel.lba-pos-bottom-left{width:100%!important;max-width:100%!important;height:80vh!important;max-height:80vh!important;border-radius:12px 12px 0 0}}.lba-panel-header{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;color:#fff;flex-shrink:0;border-radius:12px 12px 0 0}.lba-panel-title{font-weight:600;font-size:16px}.lba-panel-close{display:flex!important;align-items:center;justify-content:center;width:36px!important;height:36px!important;min-width:36px!important;min-height:36px!important;background:rgba(255,255,255,.25)!important;border:none!important;color:#fff!important;cursor:pointer!important;border-radius:50%!important;font-size:18px!important;line-height:1!important;padding:0!important;opacity:1;transition:background .2s}.lba-panel-close:hover{background:rgba(255,255,255,.4)!important}.lba-panel-close:focus{outline:2px solid rgba(255,255,255,.7);outline-offset:2px}.lba-messages{flex:1;overflow-y:auto;padding:16px!important;display:flex;flex-direction:column;gap:14px;background:#f8fafc!important;min-height:0}.lba-msg{max-width:85%!important;padding:12px 16px!important;border-radius:12px!important;font-size:14px!important;line-height:1.5;word-wrap:break-word}.lba-msg-user{align-self:flex-end!important;background:var(--lba-primary,#2563EB)!important;color:#fff!important;border-bottom-right-radius:4px!important;margin-left:auto}.lba-msg-bot{align-self:flex-start!important;background:#f1f3f5!important;color:#1e293b!important;border-bottom-left-radius:4px!important}.lba-msg-welcome{align-self:flex-start}.lba-typing{display:flex!important;gap:4px;padding:12px 16px!important;align-self:flex-start!important;background:#f1f3f5!important;border-radius:12px!important;border-bottom-left-radius:4px!important;min-width:60px}.lba-typing span{width:8px;height:8px;border-radius:50%;background:#94a3b8;animation:lba-bounce 1.4s ease-in-out infinite both}.lba-typing span:nth-child(1){animation-delay:-.32s}.lba-typing span:nth-child(2){animation-delay:-.16s}@keyframes lba-bounce{0%,80%,100%{transform:scale(0)}40%{transform:scale(1)}}.lba-input-row{display:flex;gap:8px;padding:12px 16px;background:#fff;border-top:1px solid #e2e8f0;flex-shrink:0}.lba-input{flex:1;padding:10px 14px;border:1px solid #e2e8f0;border-radius:8px;font-size:14px;font-family:inherit}.lba-input:focus{outline:none;border-color:var(--lba-primary,#2563EB)}.lba-send{padding:10px 16px;background:var(--lba-primary,#2563EB);color:#fff;border:none;border-radius:8px;font-weight:500;cursor:pointer;flex-shrink:0;transition:opacity .2s}.lba-send:hover:not(:disabled){opacity:.95}.lba-send:disabled{opacity:.6;cursor:not-allowed}.lba-send:focus{outline:2px solid var(--lba-primary);outline-offset:2px}.lba-footer{padding:6px 16px;text-align:center;flex-shrink:0;background:#f1f5f9;border-top:1px solid #e2e8f0}.lba-footer a{font-size:11px;color:#94a3b8;text-decoration:none}.lba-footer a:hover{text-decoration:underline;color:#64748b}.lba-panel-body{flex:1;min-height:0;display:flex;flex-direction:column;overflow:hidden}.lba-panel-view{display:none;flex:1;flex-direction:column;min-height:0;overflow:hidden}.lba-panel-view.lba-active{display:flex!important}.lba-nav{display:flex;justify-content:space-around;align-items:center;flex-shrink:0;padding:10px 8px 8px;background:#fff;border-top:1px solid #e2e8f0}.lba-nav-item{display:flex;flex-direction:column;align-items:center;gap:2px;cursor:pointer;background:none;border:none;padding:6px 10px;border-radius:8px;color:#64748b;font-size:11px;font-family:inherit;transition:color .2s}.lba-nav-item:hover{color:#334155}.lba-nav-item.lba-nav-active{color:var(--lba-primary,#2563EB);font-weight:600}.lba-nav-item.lba-nav-active .lba-nav-icon{color:var(--lba-primary,#2563EB)}.lba-nav-icon{width:22px;height:22px;color:#94a3b8;flex-shrink:0}.lba-home{overflow-y:auto;padding:16px;background:#f8fafc}.lba-home-greeting{font-size:14px;color:#64748b;margin-bottom:12px;line-height:1.5}.lba-home-cta{display:flex;align-items:center;gap:12px;padding:14px 16px;background:#fff;border-radius:12px;box-shadow:0 1px 3px rgba(0,0,0,.08);cursor:pointer;margin-bottom:20px;border:none;width:100%;text-align:left;font-family:inherit;transition:box-shadow .2s}.lba-home-cta:hover{box-shadow:0 2px 8px rgba(0,0,0,.12)}.lba-home-cta-icon{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;flex-shrink:0;color:#fff}.lba-home-cta-text{font-weight:600;font-size:15px;color:#1e293b;flex:1}.lba-home-cta-arrow{color:#94a3b8;font-size:18px}.lba-home-section-title{font-weight:600;font-size:14px;color:#334155;margin-bottom:10px}.lba-home-links{background:#fff;border-radius:12px;box-shadow:0 1px 3px rgba(0,0,0,.08);overflow:hidden}.lba-home-link{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border:none;background:none;width:100%;cursor:pointer;font-size:14px;color:#334155;font-family:inherit;text-align:left;border-bottom:1px solid #f1f5f9}.lba-home-link:last-child{border-bottom:none}.lba-home-link:hover{background:#f8fafc}.lba-home-link-arrow{color:#94a3b8;font-size:16px}.lba-kb{display:flex;flex-direction:column;min-height:0;overflow:hidden;background:#f8fafc}.lba-kb-search{padding:12px 16px;flex-shrink:0}.lba-kb-search input{width:100%;padding:10px 12px 10px 36px;border:1px solid #e2e8f0;border-radius:8px;font-size:14px;font-family:inherit;background:#fff url('data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2220%22 height=%2220%22 viewBox=%220 0 24 24%22 fill=%22none%22 stroke=%22%2394a3b8%22 stroke-width=%222%22%3E%3Ccircle cx=%2211%22 cy=%2211%22 r=%228%22/%3E%3Cpath d=%22m21 21-4.35-4.35%22/%3E%3C/svg%3E') no-repeat 10px center;background-size:18px}.lba-kb-list{flex:1;overflow-y:auto;padding:0 16px 16px}.lba-kb-category{background:#fff;border-radius:12px;box-shadow:0 1px 3px rgba(0,0,0,.08);margin-bottom:12px;overflow:hidden}.lba-kb-cat-head{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;cursor:pointer;border:none;width:100%;background:none;font-family:inherit;font-size:14px;font-weight:600;color:#334155;text-align:left}.lba-kb-cat-head:hover{background:#f8fafc}.lba-kb-cat-count{font-size:12px;font-weight:400;color:#64748b}.lba-kb-cat-arrow{color:#94a3b8;font-size:14px;transition:transform .2s}.lba-kb-cat-open .lba-kb-cat-arrow{transform:rotate(90deg)}.lba-kb-items{display:none;border-top:1px solid #f1f5f9}.lba-kb-cat-open .lba-kb-items{display:block}.lba-kb-item{padding:12px 16px;border-bottom:1px solid #f1f5f9;cursor:pointer;font-size:13px;color:#475569;text-align:left;background:none;width:100%;font-family:inherit}.lba-kb-item:last-child{border-bottom:none}.lba-kb-item:hover{background:#f8fafc;color:#1e293b}.lba-kb-empty{padding:24px 16px;text-align:center;color:#64748b;font-size:14px}.lba-kb-article-card{background:#fff;border-radius:12px;box-shadow:0 1px 3px rgba(0,0,0,.08);margin-bottom:12px;padding:14px 16px;cursor:pointer;text-align:left;border:none;width:100%;font-family:inherit}.lba-kb-article-card:hover{box-shadow:0 2px 8px rgba(0,0,0,.1)}.lba-kb-article-title{font-weight:600;font-size:14px;color:#334155;margin-bottom:4px}.lba-kb-article-snippet{font-size:12px;color:#64748b;line-height:1.4}.lba-kb-answer{display:none;padding:12px 16px;background:#f1f5f9;font-size:13px;color:#334155;line-height:1.5;white-space:pre-wrap}";t.textContent=e,document.head.appendChild(t)}}function V(t){var e=(t||"bottom-right").toLowerCase();return e==="bottom-left"?"lba-pos-bottom-left":e==="top-right"?"lba-pos-top-right":e==="top-left"?"lba-pos-top-left":"lba-pos-bottom-right"}var J={1:'<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg>',2:'<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/></svg>',3:'<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/><path d="M14 8a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v10l4-4h7a2 2 0 0 0 2-2z" opacity="0.7"/></svg>',4:'<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/><circle cx="8" cy="12" r="1" fill="currentColor"/><circle cx="12" cy="12" r="1" fill="currentColor"/><circle cx="16" cy="12" r="1" fill="currentColor"/></svg>',5:'<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="10" rx="2"/><path d="M7 11V7a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v4"/><circle cx="8.5" cy="15.5" r="1"/><circle cx="15.5" cy="15.5" r="1"/><path d="M12 11v2"/></svg>',6:'<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 18v-6a9 9 0 0 1 18 0v6"/><path d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"/></svg>',7:'<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.8 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></svg>',8:'<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>',9:'<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/><path d="M7 10h10"/><path d="M7 14h6"/></svg>',10:'<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg>'};function Z(t){var e=String(t||"1").trim();return J[e]||J[1]}var fe='<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>';function ge(t){var e=document.createElement("button");e.type="button",e.className="lba-bubble "+V(t.widgetPosition),e.setAttribute("aria-label","Open chat"),e.style.backgroundColor=t.primaryColor||"#2563EB";var n=document.createElement("span");n.style.display="flex",n.style.alignItems="center",n.style.justifyContent="center",n.style.color="#fff",n.innerHTML=Z(t.avatarStyle),e.appendChild(n);function o(s){n.innerHTML=s?fe:Z(t.avatarStyle),e.setAttribute("aria-label",s?"Close chat":"Open chat")}return{bubble:e,setIconOpen:o}}function $(){return re+C.trim()}function Le(){try{return sessionStorage.getItem($())==="1"}catch{return!1}}function xe(){try{sessionStorage.setItem($(),"1")}catch{}}function ve(t,e,n){var o="We're Online!",s=(t.welcomeMessage||"How may I help you today?").trim(),i=V(t.widgetPosition),b=document.createElement("div");b.className="lba-welcome-wrap "+i,b.setAttribute("aria-live","polite");var p=document.createElement("div");p.className="lba-welcome-bubble";var l=document.createElement("button");l.type="button",l.className="lba-welcome-close",l.setAttribute("aria-label","Close message"),l.innerHTML="&#10005;",l.addEventListener("click",function(f){f.stopPropagation(),w()});var g=document.createElement("div");g.className="lba-welcome-line1";var A=document.createElement("span"),x=document.createElement("span");x.className="lba-welcome-cursor",g.appendChild(A),g.appendChild(x);var v=document.createElement("div");v.className="lba-welcome-line2";var M=document.createElement("span"),k=document.createElement("span");k.className="lba-welcome-cursor",k.style.display="none",v.appendChild(M),v.appendChild(k),p.appendChild(l),p.appendChild(g),p.appendChild(v),b.appendChild(p),p.addEventListener("click",function(f){l.contains(f.target)||(w(),typeof n=="function"&&n())});function w(){b.classList.add("lba-welcome-hidden"),b.classList.remove("lba-welcome-visible"),xe(),typeof e=="function"&&e()}function y(f,a,r,h,E,L){if(h>=r.length){a&&(a.style.display="none"),L&&setTimeout(L,80);return}f.textContent=r.slice(0,h+1),setTimeout(function(){y(f,a,r,h+1,E,L)},E)}function u(){b.classList.add("lba-welcome-visible"),x.style.display="inline-block",y(A,x,o,0,X,function(){k.style.display="inline-block",y(M,k,s,0,X,null)})}return{wrap:b,show:u,hide:w}}var W={home:'<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>',conversation:'<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>',faqs:'<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"/></svg>',articles:'<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><line x1="10" y1="9" x2="8" y2="9"/></svg>'};function we(t){var e=document.createElement("div");e.className="lba-panel lba-closed "+V(t.widgetPosition),e.setAttribute("aria-hidden","true"),e.setAttribute("role","dialog"),e.setAttribute("aria-label","Chat");var n=t.primaryColor||"#2563EB",o=t.botName||"Assistant",s=t.welcomeMessage||"Hi! How can I help?",i=document.createElement("div");i.className="lba-panel-header",i.style.backgroundColor=n;var b=document.createElement("span");b.className="lba-panel-title",b.textContent="Home";var p=document.createElement("button");p.type="button",p.className="lba-panel-close",p.setAttribute("aria-label","Close chat"),p.innerHTML="&#10005;",i.appendChild(b),i.appendChild(p),e.appendChild(i);var l=document.createElement("div");l.className="lba-panel-body";var g=document.createElement("div");g.className="lba-panel-view lba-active",g.setAttribute("data-lba-view","home");var A=document.createElement("div");A.className="lba-home",A.innerHTML='<p class="lba-home-greeting">'+Y(s)+'</p><button type="button" class="lba-home-cta" data-lba-goto="conversation"><span class="lba-home-cta-icon" style="background:'+n+'"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg></span><span class="lba-home-cta-text">Chat with us now</span><span class="lba-home-cta-arrow">&#8250;</span></button><p class="lba-home-section-title">To know about '+Y(o)+'</p><div class="lba-home-links"><button type="button" class="lba-home-link" data-lba-goto="conversation"><span>Start a conversation</span><span class="lba-home-link-arrow">&#8250;</span></button><button type="button" class="lba-home-link" data-lba-goto="faqs"><span>Browse FAQs</span><span class="lba-home-link-arrow">&#8250;</span></button><button type="button" class="lba-home-link" data-lba-goto="articles"><span>Browse Articles</span><span class="lba-home-link-arrow">&#8250;</span></button></div>',g.appendChild(A),l.appendChild(g);var x=document.createElement("div");x.className="lba-panel-view",x.setAttribute("data-lba-view","conversation");var v=document.createElement("div");v.className="lba-messages";var M=document.createElement("div");M.className="lba-msg lba-msg-bot lba-msg-welcome",M.textContent=s,v.appendChild(M);var k=document.createElement("div");k.className="lba-input-row";var w=document.createElement("input");w.type="text",w.className="lba-input",w.placeholder="Type a message...",w.setAttribute("autocomplete","off"),w.setAttribute("aria-label","Message input");var y=document.createElement("button");y.type="button",y.className="lba-send",y.textContent="Send",y.setAttribute("aria-label","Send message"),y.style.backgroundColor=n,k.appendChild(w),k.appendChild(y),x.appendChild(v),x.appendChild(k),l.appendChild(x);var u=document.createElement("div");u.className="lba-panel-view",u.setAttribute("data-lba-view","faqs"),u.innerHTML='<div class="lba-kb"><div class="lba-kb-search"><input type="text" placeholder="Search for an FAQ" aria-label="Search FAQs"/></div><div class="lba-kb-list"></div></div>',l.appendChild(u);var f=document.createElement("div");f.className="lba-panel-view",f.setAttribute("data-lba-view","articles"),f.innerHTML='<div class="lba-kb"><div class="lba-kb-search"><input type="text" placeholder="Search for an article" aria-label="Search articles"/></div><div class="lba-kb-list"></div></div>',l.appendChild(f),e.appendChild(l);var a=document.createElement("nav");a.className="lba-nav",a.setAttribute("aria-label","Panel tabs");var r=[{id:"home",label:"Home",icon:W.home},{id:"conversation",label:"Conversation",icon:W.conversation},{id:"faqs",label:"FAQs",icon:W.faqs},{id:"articles",label:"Articles",icon:W.articles}];r.forEach(function(E){var L=document.createElement("button");L.type="button",L.className="lba-nav-item"+(E.id==="home"?" lba-nav-active":""),L.setAttribute("data-lba-tab",E.id),L.setAttribute("aria-label",E.label),L.innerHTML='<span class="lba-nav-icon">'+E.icon+"</span><span>"+E.label+"</span>",a.appendChild(L)}),e.appendChild(a);var h=document.createElement("div");return h.className="lba-footer",h.innerHTML='<a href="https://localbot.ai" target="_blank" rel="noopener">Powered by LocalBot AI</a>',e.appendChild(h),{panel:e,headerTitle:b,viewHome:g,viewConversation:x,viewFaqs:u,viewArticles:f,messagesEl:v,input:w,sendBtn:y,closeBtn:p,nav:a}}function Y(t){var e=document.createElement("div");return e.textContent=t,e.innerHTML}function K(t,e,n){var o=document.createElement("div");o.className="lba-msg "+(n?"lba-msg-user":"lba-msg-bot"),o.textContent=e,t.appendChild(o),ee(t)}function ee(t){t.scrollTop=t.scrollHeight}function ye(t){var e=document.createElement("div");return e.className="lba-typing",e.setAttribute("aria-live","polite"),e.setAttribute("aria-label","Bot is typing"),e.innerHTML="<span></span><span></span><span></span>",e.setAttribute("data-lba-typing","1"),t.appendChild(e),ee(t),e}function te(t){var e=t.querySelector("[data-lba-typing]");e&&e.remove()}var ke={home:"Home",conversation:"Conversation",faqs:"FAQs",articles:"Articles"};function ae(t){var e=t.primaryColor||"#2563EB";document.documentElement.style.setProperty("--lba-primary",e);var n=ge(t),o=n.bubble,s=n.setIconOpen,i=we(t),b=i.panel,p=i.messagesEl,l=i.input,g=i.sendBtn,A="home",x=null;function v(a){a=a||"home",A=a,i.viewHome.classList.toggle("lba-active",a==="home"),i.viewConversation.classList.toggle("lba-active",a==="conversation"),i.viewFaqs.classList.toggle("lba-active",a==="faqs"),i.viewArticles.classList.toggle("lba-active",a==="articles"),i.headerTitle.textContent=ke[a]||a,i.nav.querySelectorAll(".lba-nav-item").forEach(function(r){r.classList.toggle("lba-nav-active",r.getAttribute("data-lba-tab")===a)}),a==="conversation"&&l.focus(),(a==="faqs"||a==="articles")&&!x&&M(a)}function M(a){var r=(a==="faqs"?i.viewFaqs:i.viewArticles).querySelector(".lba-kb-list");r.innerHTML='<p class="lba-kb-empty">Loading\u2026</p>',fetch(j+"/api/widget-config/"+encodeURIComponent(C.trim())+"/knowledge").then(function(h){return h.ok?h.json():Promise.reject(new Error("Failed to load"))}).then(function(h){x=h.categories||[],k(r,x,a,e,l,p,g,v,function(E){v("conversation"),l.value=E,l.focus(),f()})}).catch(function(){r.innerHTML='<p class="lba-kb-empty">Unable to load content. Try again later.</p>'})}function k(a,r,h,E,L,Be,Ae,Me,ne){a.innerHTML="";var O=a.closest(".lba-kb").querySelector(".lba-kb-search input");function Ce(){var T=O&&O.value?O.value.toLowerCase():"";r.forEach(function(B){var z=a.querySelector('[data-lba-cat-id="'+B.id+'"]');if(z){var S=(B.items||[]).filter(function(m){return!T||m.question&&m.question.toLowerCase().indexOf(T)>=0||m.answer&&m.answer.toLowerCase().indexOf(T)>=0}),_=z.querySelector(".lba-kb-items"),N=z.querySelector(".lba-kb-item-list");!_||!N||(N.innerHTML="",S.forEach(function(m){var c=document.createElement("button");c.type="button",c.className="lba-kb-item",c.textContent=(m.question||"").slice(0,120)+(m.question&&m.question.length>120?"\u2026":""),c.setAttribute("data-question",m.question||""),c.setAttribute("data-answer",m.answer||""),N.appendChild(c)}),_.style.display=S.length?"block":"none")}})}if(O&&O.addEventListener("input",Ce),!r.length){a.innerHTML='<p class="lba-kb-empty">No content in the knowledge base yet.</p>';return}r.forEach(function(T){var B=document.createElement("div");B.className="lba-kb-category",B.setAttribute("data-lba-cat-id",T.id);var z=T.items||[],S=document.createElement("button");S.type="button",S.className="lba-kb-cat-head",S.innerHTML="<span>"+Y(T.name||"Category")+'</span><span class="lba-kb-cat-count">'+z.length+" "+(h==="articles"?"Articles":"FAQs")+'</span><span class="lba-kb-cat-arrow">&#8250;</span>';var _=document.createElement("div");_.className="lba-kb-items";var N=document.createElement("div");N.className="lba-kb-item-list",z.forEach(function(m){var c=document.createElement("button");c.type="button",c.className="lba-kb-item",c.textContent=(m.question||"").slice(0,120)+(m.question&&m.question.length>120?"\u2026":""),c.setAttribute("data-question",m.question||""),c.setAttribute("data-answer",m.answer||""),N.appendChild(c)}),_.appendChild(N),B.appendChild(S),B.appendChild(_),S.addEventListener("click",function(){B.classList.toggle("lba-kb-cat-open")}),N.addEventListener("click",function(m){var c=m.target.closest(".lba-kb-item");if(c){var ie=c.getAttribute("data-question")||"",Ee=c.getAttribute("data-answer")||"",U=c.nextElementSibling;if(U&&U.classList.contains("lba-kb-answer")){U.style.display=U.style.display==="none"?"block":"none";return}var H=document.createElement("div");if(H.className="lba-kb-answer",H.style.display="block",H.textContent=Ee||"No answer.",c.parentNode.insertBefore(H,c.nextSibling),ie&&ne){var q=document.createElement("button");q.type="button",q.className="lba-kb-item",q.style.marginTop="4px",q.textContent="Ask this in chat \u2192",q.addEventListener("click",function(){ne(ie)}),H.parentNode.insertBefore(q,H.nextSibling)}}}),a.appendChild(B)})}i.viewHome.addEventListener("click",function(a){var r=a.target.closest("[data-lba-goto]");r&&v(r.getAttribute("data-lba-goto"))}),i.nav.querySelectorAll(".lba-nav-item").forEach(function(a){a.addEventListener("click",function(){v(a.getAttribute("data-lba-tab"))})});function w(){b.classList.remove("lba-closed"),b.setAttribute("aria-hidden","false"),s(!0),v("home")}function y(){b.classList.add("lba-closed"),b.setAttribute("aria-hidden","true"),s(!1)}var u=null;u=ve(t,null,w),document.body.appendChild(u.wrap),setTimeout(function(){u&&u.wrap.parentNode&&u.show()},de),o.addEventListener("click",function(){b.classList.contains("lba-closed")?(u&&u.hide(),w()):y()}),i.closeBtn.addEventListener("click",function(){y()});function f(){var a=(l.value||"").trim();a&&(l.value="",K(p,a,!0),ye(p),g.disabled=!0,fetch(j+"/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:C.trim(),message:a,session_id:ue()})}).then(function(r){return r.json().then(function(h){if(!r.ok)throw new Error(h.error||"Request failed");return h})}).then(function(r){te(p),K(p,r.answer||"",!1)}).catch(function(){te(p),K(p,"Sorry, something went wrong. Please try again later.",!1)}).finally(function(){g.disabled=!1,l.focus()}))}g.addEventListener("click",f),l.addEventListener("keydown",function(a){a.key==="Enter"&&!a.shiftKey&&(a.preventDefault(),f())}),document.body.appendChild(o),document.body.appendChild(b),u&&document.body.insertBefore(u.wrap,o)}function oe(){he();var t=be(C);if(t){ae(t);return}fetch(j+"/api/widget-config/"+encodeURIComponent(C.trim())).then(function(e){if(!e.ok)throw new Error("Config failed "+e.status);return e.json()}).then(function(e){me(C,e),ae(e)}).catch(function(e){console.warn("[LocalBot AI] Could not load widget config:",e)})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",oe):oe()})();})();
