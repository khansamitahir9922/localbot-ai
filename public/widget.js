"use strict";(()=>{(function(){"use strict";var u=document.currentScript;if(!u)return;var s=u.getAttribute("data-token");if(!s||!s.trim()){console.warn("[LocalBot AI] Missing data-token on script tag.");return}var f="";try{f=new URL(u.src).origin}catch{console.warn("[LocalBot AI] Could not determine script origin.");return}var h="lba_session_"+s.trim(),g="lba_config_",N=36e5,p=24,y=380,v=520,A=480;function M(e){var t=g+(e||s).trim();try{var o=localStorage.getItem(t);if(!o)return null;var a=JSON.parse(o);if(!a||typeof a.lastFetched!="number"||Date.now()-a.lastFetched>N)return null;var n={};return a.botName!==void 0&&(n.botName=a.botName),a.primaryColor!==void 0&&(n.primaryColor=a.primaryColor),a.welcomeMessage!==void 0&&(n.welcomeMessage=a.welcomeMessage),a.fallbackMessage!==void 0&&(n.fallbackMessage=a.fallbackMessage),a.widgetPosition!==void 0&&(n.widgetPosition=a.widgetPosition),n}catch{return null}}function S(e,t){if(!(!t||typeof t!="object")){var o=g+(e||s).trim();try{var a={botName:t.botName,primaryColor:t.primaryColor,welcomeMessage:t.welcomeMessage,fallbackMessage:t.fallbackMessage,widgetPosition:t.widgetPosition,lastFetched:Date.now()};localStorage.setItem(o,JSON.stringify(a))}catch{}}}function L(){try{var e=localStorage.getItem(h);if(e)return e;var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(o){var a=Math.random()*16|0,n=o==="x"?a:a&3|8;return n.toString(16)});return localStorage.setItem(h,t),t}catch{return"session-"+Date.now()+"-"+Math.random().toString(36).slice(2)}}function I(){if(!document.getElementById("lba-widget-styles")){var e=document.createElement("style");e.id="lba-widget-styles";var t=".lba-bubble{position:fixed!important;width:56px!important;height:56px!important;border-radius:50%!important;border:none!important;cursor:pointer!important;box-shadow:0 4px 14px rgba(0,0,0,.18)!important;display:flex!important;align-items:center;justify-content:center;color:#fff!important;font-size:24px!important;transition:transform .2s ease,box-shadow .2s ease,opacity .2s ease;z-index:2147483646;}.lba-bubble:hover{transform:scale(1.06)!important;box-shadow:0 6px 20px rgba(0,0,0,.22)!important}.lba-bubble:active{transform:scale(.98)!important}.lba-bubble:focus{outline:2px solid rgba(255,255,255,.5);outline-offset:2px}.lba-bubble.lba-pos-bottom-right{bottom:"+p+"px;right:"+p+"px}.lba-bubble.lba-pos-bottom-left{bottom:"+p+"px;left:"+p+"px}.lba-bubble.lba-pos-top-right{top:"+p+"px;right:"+p+"px}.lba-bubble.lba-pos-top-left{top:"+p+"px;left:"+p+"px}.lba-panel{position:fixed!important;background:#fff!important;border-radius:12px 12px 0 0!important;box-shadow:0 -4px 28px rgba(0,0,0,.15),0 0 1px rgba(0,0,0,.08)!important;display:flex;flex-direction:column;z-index:2147483647;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif!important;overflow:hidden;transition:transform .3s cubic-bezier(0.32,0.72,0,1),opacity .25s ease;}.lba-panel.lba-closed{transform:translateY(100%);opacity:0;pointer-events:none}.lba-panel.lba-pos-bottom-right,.lba-panel.lba-pos-bottom-left{bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:"+y+"px;height:"+v+"px;max-height:85vh}.lba-panel.lba-closed.lba-pos-bottom-right,.lba-panel.lba-closed.lba-pos-bottom-left{transform:translate(-50%,100%)}.lba-panel.lba-pos-top-right,.lba-panel.lba-pos-top-left{top:0;left:50%;transform:translateX(-50%);width:100%;max-width:"+y+"px;height:"+v+"px;max-height:85vh}.lba-panel.lba-closed.lba-pos-top-right,.lba-panel.lba-closed.lba-pos-top-left{transform:translate(-50%,-100%)}@media (max-width:"+A+"px){.lba-panel{width:90vw!important;max-width:90vw!important;height:80vh!important;max-height:80vh!important;border-radius:12px 12px 0 0}}.lba-panel-header{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;color:#fff;flex-shrink:0;border-radius:12px 12px 0 0}.lba-panel-title{font-weight:600;font-size:16px}.lba-panel-close{background:transparent;border:none;color:inherit;cursor:pointer;padding:6px;line-height:1;opacity:.9;border-radius:4px;font-size:18px}.lba-panel-close:hover{opacity:1}.lba-panel-close:focus{outline:2px solid rgba(255,255,255,.6);outline-offset:2px}.lba-messages{flex:1;overflow-y:auto;padding:16px!important;display:flex;flex-direction:column;gap:14px;background:#f8fafc!important;min-height:0}.lba-msg{max-width:85%!important;padding:12px 16px!important;border-radius:12px!important;font-size:14px!important;line-height:1.5;word-wrap:break-word}.lba-msg-user{align-self:flex-end!important;background:var(--lba-primary,#2563EB)!important;color:#fff!important;border-bottom-right-radius:4px!important;margin-left:auto}.lba-msg-bot{align-self:flex-start!important;background:#f1f3f5!important;color:#1e293b!important;border-bottom-left-radius:4px!important}.lba-msg-welcome{align-self:flex-start}.lba-typing{display:flex!important;gap:4px;padding:12px 16px!important;align-self:flex-start!important;background:#f1f3f5!important;border-radius:12px!important;border-bottom-left-radius:4px!important;min-width:60px}.lba-typing span{width:8px;height:8px;border-radius:50%;background:#94a3b8;animation:lba-bounce 1.4s ease-in-out infinite both}.lba-typing span:nth-child(1){animation-delay:-.32s}.lba-typing span:nth-child(2){animation-delay:-.16s}@keyframes lba-bounce{0%,80%,100%{transform:scale(0)}40%{transform:scale(1)}}.lba-input-row{display:flex;gap:8px;padding:12px 16px;background:#fff;border-top:1px solid #e2e8f0;flex-shrink:0}.lba-input{flex:1;padding:10px 14px;border:1px solid #e2e8f0;border-radius:8px;font-size:14px;font-family:inherit}.lba-input:focus{outline:none;border-color:var(--lba-primary,#2563EB)}.lba-send{padding:10px 16px;background:var(--lba-primary,#2563EB);color:#fff;border:none;border-radius:8px;font-weight:500;cursor:pointer;flex-shrink:0;transition:opacity .2s}.lba-send:hover:not(:disabled){opacity:.95}.lba-send:disabled{opacity:.6;cursor:not-allowed}.lba-send:focus{outline:2px solid var(--lba-primary);outline-offset:2px}.lba-footer{padding:6px 16px;text-align:center;flex-shrink:0;background:#f1f5f9;border-top:1px solid #e2e8f0}.lba-footer a{font-size:11px;color:#94a3b8;text-decoration:none}.lba-footer a:hover{text-decoration:underline;color:#64748b}";e.textContent=t,document.head.appendChild(e)}}function w(e){var t=(e||"bottom-right").toLowerCase();return t==="bottom-left"?"lba-pos-bottom-left":t==="top-right"?"lba-pos-top-right":t==="top-left"?"lba-pos-top-left":"lba-pos-bottom-right"}function P(e){var t=document.createElement("button");return t.type="button",t.className="lba-bubble "+w(e.widgetPosition),t.setAttribute("aria-label","Open chat"),t.style.backgroundColor=e.primaryColor||"#2563EB",t.innerHTML="&#128172;",t}function _(e){var t=document.createElement("div");t.className="lba-panel lba-closed "+w(e.widgetPosition),t.setAttribute("aria-hidden","true"),t.setAttribute("role","dialog"),t.setAttribute("aria-label","Chat");var o=document.createElement("div");o.className="lba-panel-header",o.style.backgroundColor=e.primaryColor||"#2563EB";var a=document.createElement("span");a.className="lba-panel-title",a.textContent=e.botName||"Assistant";var n=document.createElement("button");n.type="button",n.className="lba-panel-close",n.setAttribute("aria-label","Close chat"),n.innerHTML="&#10005;",o.appendChild(a),o.appendChild(n),t.appendChild(o);var i=document.createElement("div");i.className="lba-messages";var d=e.welcomeMessage||"Hi! How can I help?",b=document.createElement("div");b.className="lba-msg lba-msg-bot lba-msg-welcome",b.textContent=d,i.appendChild(b),t.appendChild(i);var c=document.createElement("div");c.className="lba-input-row";var r=document.createElement("input");r.type="text",r.className="lba-input",r.placeholder="Type a message...",r.setAttribute("autocomplete","off"),r.setAttribute("aria-label","Message input");var l=document.createElement("button");l.type="button",l.className="lba-send",l.textContent="Send",l.setAttribute("aria-label","Send message"),l.style.backgroundColor=e.primaryColor||"#2563EB",c.appendChild(r),c.appendChild(l),t.appendChild(c);var m=document.createElement("div");return m.className="lba-footer",m.innerHTML='<a href="https://localbot.ai" target="_blank" rel="noopener">Powered by LocalBot AI</a>',t.appendChild(m),{panel:t,messagesEl:i,input:r,sendBtn:l,closeBtn:n}}function x(e,t,o){var a=document.createElement("div");a.className="lba-msg "+(o?"lba-msg-user":"lba-msg-bot"),a.textContent=t,e.appendChild(a),C(e)}function C(e){e.scrollTop=e.scrollHeight}function T(e){var t=document.createElement("div");return t.className="lba-typing",t.setAttribute("aria-live","polite"),t.setAttribute("aria-label","Bot is typing"),t.innerHTML="<span></span><span></span><span></span>",t.setAttribute("data-lba-typing","1"),e.appendChild(t),C(e),t}function E(e){var t=e.querySelector("[data-lba-typing]");t&&t.remove()}function k(e){var t=e.primaryColor||"#2563EB";document.documentElement.style.setProperty("--lba-primary",t);var o=P(e),a=_(e),n=a.panel,i=a.messagesEl,d=a.input,b=a.sendBtn;o.addEventListener("click",function(){n.classList.remove("lba-closed"),n.setAttribute("aria-hidden","false"),d.focus()}),a.closeBtn.addEventListener("click",function(){n.classList.add("lba-closed"),n.setAttribute("aria-hidden","true")});function c(){var r=(d.value||"").trim();r&&(d.value="",x(i,r,!0),T(i),b.disabled=!0,fetch(f+"/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:s.trim(),message:r,session_id:L()})}).then(function(l){return l.json().then(function(m){if(!l.ok)throw new Error(m.error||"Request failed");return m})}).then(function(l){E(i),x(i,l.answer||"",!1)}).catch(function(){E(i),x(i,"Sorry, something went wrong. Please try again later.",!1)}).finally(function(){b.disabled=!1,d.focus()}))}b.addEventListener("click",c),d.addEventListener("keydown",function(r){r.key==="Enter"&&!r.shiftKey&&(r.preventDefault(),c())}),document.body.appendChild(o),document.body.appendChild(n)}function B(){I();var e=M(s);if(e){k(e);return}fetch(f+"/api/widget-config/"+encodeURIComponent(s.trim())).then(function(t){if(!t.ok)throw new Error("Config failed "+t.status);return t.json()}).then(function(t){S(s,t),k(t)}).catch(function(t){console.warn("[LocalBot AI] Could not load widget config:",t)})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",B):B()})();})();
